<!DOCTYPE html>
<html>
<head>
	<link href="css/bootstrap.min.css" rel="stylesheet"/>
	<link href="css/tilt-view.css" rel="stylesheet">
	<script type='text/javascript' src='js/jquery.min.js'></script>
	<script type='text/javascript' src='js/d3.v4.min.js'></script>
	<script type='text/javascript' src='js/topojson.v1.min.js'></script>	
	<script type='text/javascript' src='js/bootstrap.min.js'></script>
	<script language="javascript">

	//TODO : enable zoom by click
	
	var regions =["Africa","Asia","Europe","North America","Oceania","South America"];
	var regionZoomArgs={"Africa" :  		{"args" : {"translate" : [375,250], "scale" : 350}},
						"Asia" :  			{"args" : {"translate" : [-50,430], "scale" : 350}},
						"Europe" :  		{"args" : {"translate" : [300,870], "scale" : 550}},
						"North America" :  	{"args" : {"translate" : [1100,550], "scale" : 350}},
						"Oceania" :  		{"args" : {"translate" : [-920,-30], "scale" : 550}},
						"South America" :  	{"args" : {"translate" : [860,80], "scale" : 350}}};
	var active = d3.select(null);

	
	var svg;
	var projection;
	var path;
	var width = 960;
	var height = 500;	


	var bootcampLocations=	[	{city: "Johannesburg, South Africa" , latitude: -26.2041, longitude: 28.0473},
								{city: "Los Angeles, CA" , latitude: 34.0522,  longitude: -118.2437},
								{city: "Irvine, CA" , latitude: 33.6839, longitude:  -117.7947},
								{city: "Salt Lake City, UT" , latitude: 40.7608 , longitude: -111.8910},
								{city: "Tampa, FL (Verizon)" , latitude: 27.9506, longitude: -82.4572},
								{city: "San Diego, CA" , latitude: 32.7157 ,longitude: -117.1611},
								{city: "Atlanta, GA" , latitude: 33.7490, longitude:-84.3880},
								{city: "Phoenix, AZ" , latitude: 33.4484, longitude: -112.0740},
								{city: "Philadelphia, PA" , latitude: 39.9526, longitude: -75.1652},
								{city: "Houston, TX" , latitude: 29.7604, longitude: -95.3698},
								{city: "Dallas, TX (Citigroup)" , latitude: 32.7767 , longitude: -96.7970},
								{city: "Frankfurt, Germany" , latitude: 50.1109, longitude: 8.6821},
								{city: "Kansas City, MO" , latitude: 39.0997, longitude: -94.5786},
								{city: "Paris, France" , latitude: 48.8566, longitude: 2.3522},
								{city: "Tampa, FL" , latitude: 27.9506, longitude: -82.4572},
								{city: "Tulsa, OK" , latitude: 36.1540, longitude: -95.9928},
								{city: "Chicago, IL" , latitude: 41.8781, longitude: -87.6298},
								{city: "London, England" , latitude: 51.5074, longitude: -0.1278},
								{city: "Boston, MA" , latitude: 42.3601, longitude: -71.0589},
								{city: "Seattle, WA" , latitude: 47.6062, longitude:-122.3321},
								{city: "Charlotte, NC" , latitude: 35.2271, longitude:-80.8431},
								{city: "Asheville, NC" , latitude: 35.5951, longitude:-82.5515},
								{city: "Rockville, MD" , latitude: 39.0840, longitude:-77.1528},
								{city: "Denver, CO" , latitude: 39.55414, longitude:-104.8827},
								{city: "San Francisco, CA" , latitude: 37.78352, longitude:-122.4169},
								{city: "Oakland, CA" , latitude: 37.81539, longitude:-122.2599},
								{city: "Des Moines, IA" , latitude: 41.59548, longitude:-93.61407}	
							];
														
							


	var zoomRegion=decodeURI(location.search.split("region=")[1]);
		if (zoomRegion == "undefined") {
			zoomRegion="World";
	}
	
	

	

	function doZoom() {
		if (active.node() === this) return reset();
		active.classed("active", false);
		active = d3.select(this).classed("active", true);

		var region=this.id;

		projection
				.scale(regionZoomArgs[region].args.scale)
				.translate(regionZoomArgs[region].args.translate);	
								
		d3.selectAll("path").transition().duration(750).attr("d",path);
					
		d3.selectAll("circle").transition().duration(750).attr("transform", function(d) {return "translate(" + projection([d.longitude,d.latitude]) + ")";});


	}
	
	function reset() {
		active.classed("active", false);
		active = d3.select(null);

		projection.scale(153)
			.translate([480,250]);
		
		d3.selectAll("path").transition().duration(750).attr("d",path);
		
		d3.selectAll("circle").transition().duration(750).attr("transform", function(d) {return "translate(" + projection([d.longitude,d.latitude]) + ")";});

	}
	

	</script>
</head>
<body class="mapBody">
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
			  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			  </button>
			  <a class="navbar-brand" href="#">Pathfinder Bootcamps</a>
			  
			</div>
			<img class="col-xs-5" src="images/federation-bar.png"/>
	
		  </div>
    </nav>
	
	<div class="container-fluid" id="tiltMap">
	</div>
	<script>
	window.onload=initialize();	
	
	function initialize() {
		projection=d3.geoMercator();

					
		path=d3.geoPath()
			.projection(projection);

		svg = d3.select("#tiltMap").append("svg")
		.attr("width", width)
		.attr("height", height);
		
		var filter=svg.append("defs")
			.append("filter")
				.attr("id","drop-shadow")
				.attr("x",0)
				.attr("y",0)
				.attr("width","200%")
				.attr("height","200%");
		
		filter.append("feOffest")
			.attr("result","offOut")
			.attr("in","SourceAlpha")
			.attr("dx",20)
			.attr("dy",20);
			
		filter.append("feGaussianBlur")
			.attr("result","blurOut")
			.attr("in","offOut")
			.attr("stdDeviation",10);
		
		filter.append("feBlend")
			.attr("in","SourceGraphic")
			.attr("in2","blurOut")
			.attr("mode","normal");
		
		svg.append("rect")
		.attr("class", "background")
		.attr("width", width)
		.attr("height", height)
		.on("click",reset);

		
		
		d3.json("countryData/world.json", function(error, world) {
			if (error) return console.error(error);
			var subunits=topojson.feature(world, world.objects.subunits);
			
			for (var i=0, len=regions.length;i < len; i++) {
				var region=regions[i];
				
				g=svg.append("g").attr("id",region).attr("class","continent").on("click",doZoom);
				
				g.selectAll(".subunit")
				.data(topojson.feature(world, world.objects.subunits).features.filter(function(d) { return d.properties.continent==region;}))
				.enter()
					.append("path")
					.attr("class", function(d) {return "subunit " + d.id ;})
					.attr("d",path)
					.attr("stroke", "#888888")
					.attr("filter","url(#drop-shadow)");
					
				
				
				if (region == "North America") {
					g.append("path")
					.datum(topojson.mesh(world, world.objects.states, function(a,b) {return a != b && a.id == "USA";}))
					.attr("class", "state-boundary")
					.attr("stroke", "#888888")
					.attr("fill","none")
					.attr("d", path);
				}
				
				
					
			}
			
			var circles=svg.selectAll("circle").data(bootcampLocations);
			
			circles.enter().append("circle")
				.attr("r",3)
				.attr("id", function(d) {return d.city;})
				.attr("transform", function(d) {return "translate(" + projection([d.longitude,d.latitude]) + ")";})
				.attr("fill","#4682B4")
				.attr("stroke","#000000");
				
			circles.exit().remove();
			
			/*svg.append("text")
				.attr("transform","translate(" + projection([bootcampLocations[loc].longitude -.5 ,bootcampLocations[loc].latitude]) + ")")
				.text(loc);*/
		});
		
		
		
		

	}

	</script>
</body>
</html>

